stages:
  - build

manual-build:
  variables:
    BASE_IMAGE_TAG: 1.0.0
  tags:
    - devenv
  stage: build
  script:
    - source env.sh
    - docker build -t $REGISTRY_URL$REGISTRY_URI:$BASE_IMAGE_TAG .
    - docker login -u "$REGISTRY_USER" -p "$REGISTRY_PASS" https://$REGISTRY_URL
    - docker push $REGISTRY_URL$REGISTRY_URI:$BASE_IMAGE_TAG
    - docker logout https://$REGISTRY_URL
    - docker rmi $REGISTRY_URL$REGISTRY_URI:$BASE_IMAGE_TAG
  when: manual
